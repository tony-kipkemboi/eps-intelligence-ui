# EPS Account Intelligence Agent - Complete Architecture

![Architecture](/Users/tonykipkemboi/Workspace/eps-chatbot/docs/images/EPS-intel-agent-architecture.png)

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          EPS ACCOUNT INTELLIGENCE AGENT                      â”‚
â”‚                    Enterprise Search + AI Agent Platform                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. ğŸ¨ FRONTEND ARCHITECTURE (React/TypeScript UI)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER INTERFACE (Databricks Apps)                                        â”‚
â”‚  https://eps-agent-dev-tony-kipkemboi-7711090402957940.aws.databricks... â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  CLIENT APPLICATION (/client/)                                   â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  React + TypeScript + Vite Build                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ src/components/                                             â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ message.tsx                (Main message component)     â”‚   â”‚
â”‚  â”‚  â”‚   â”‚   â””â”€â”€ Collects allToolParts for unified display          â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ elements/                                               â”‚   â”‚
â”‚  â”‚  â”‚   â”‚   â”œâ”€â”€ chain-of-thought.tsx  (Tool work display)          â”‚   â”‚
â”‚  â”‚  â”‚   â”‚   â”‚   â””â”€â”€ "Show work â€¢ X sources"                        â”‚   â”‚
â”‚  â”‚  â”‚   â”‚   â””â”€â”€ source-carousel.tsx   (Sources display)            â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€â”€ chat-interface.tsx        (Main chat UI)               â”‚   â”‚
â”‚  â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ src/lib/                                                     â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ parse-tool-output.ts      (Tool name formatting)       â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ api-client.ts             (Backend communication)      â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€â”€ auth.ts                   (JWT validation)             â”‚   â”‚
â”‚  â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚  â””â”€â”€ client/dist/                  (Built assets)                â”‚   â”‚
â”‚  â”‚      â””â”€â”€ Synced to Databricks workspace                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  JWT Validation Layer:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. Receive JWT from x-forwarded-access-token header            â”‚    â”‚
â”‚  â”‚ 2. Verify RS256 signature (Databricks public key)               â”‚    â”‚
â”‚  â”‚ 3. Check expiration & issuer                                    â”‚    â”‚
â”‚  â”‚ 4. Extract user email from JWT.sub field                        â”‚    â”‚
â”‚  â”‚ 5. Pass to backend via custom_inputs                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ HTTPS POST /serving-endpoints/responses
                                â”‚ Body: { messages, custom_inputs: { user_email } }
                                â”‚
                                â–¼
```

---

## 2. ğŸ” AUTHENTICATION & SECURITY LAYER

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AUTHENTICATION FLOW (OAuth 2.0 + JWT + ActAs Pattern)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Step 1: User Authentication                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  User    â”‚â”€â”€â”€â”€â”€â–¶â”‚  Okta    â”‚â”€â”€â”€â”€â”€â–¶â”‚  Databricks     â”‚              â”‚
â”‚  â”‚ Browser  â”‚ SSO  â”‚   IDP    â”‚ OIDC â”‚  Platform       â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                              â”‚                           â”‚
â”‚                                              â”‚ Issue JWT (RS256)         â”‚
â”‚                                              â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  JWT TOKEN PAYLOAD:                                            â”‚     â”‚
â”‚  â”‚  {                                                              â”‚     â”‚
â”‚  â”‚    "sub": "tony.kipkemboi@guild.com",                          â”‚     â”‚
â”‚  â”‚    "iss": "https://dbc-*.databricks.com/oidc",                 â”‚     â”‚
â”‚  â”‚    "exp": 1234567890,                                          â”‚     â”‚
â”‚  â”‚    "iat": 1234567800                                           â”‚     â”‚
â”‚  â”‚  }                                                              â”‚     â”‚
â”‚  â”‚  Signed with: Databricks private key (RS256)                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                          â”‚
â”‚  Step 2: UI Validation                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  UI App (client/src/lib/auth.ts):                          â”‚        â”‚
â”‚  â”‚  1. Extract JWT from x-forwarded-access-token header        â”‚        â”‚
â”‚  â”‚  2. Verify signature with Databricks public key             â”‚        â”‚
â”‚  â”‚  3. Validate expiration timestamp                            â”‚        â”‚
â”‚  â”‚  4. Confirm issuer matches Databricks                        â”‚        â”‚
â”‚  â”‚  5. Extract user_email from JWT.sub                          â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                          â”‚
â”‚  Step 3: Backend Receives User Context                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Agent receives via custom_inputs:                          â”‚        â”‚
â”‚  â”‚  {                                                           â”‚        â”‚
â”‚  â”‚    "user_email": "tony.kipkemboi@guild.com",                â”‚        â”‚
â”‚  â”‚    "conversation_id": "abc123"                               â”‚        â”‚
â”‚  â”‚  }                                                           â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                          â”‚
â”‚  Step 4: ActAs Pattern (RFC 8693 Token Exchange)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Agent normalizes email:                                    â”‚        â”‚
â”‚  â”‚    @guild.com â†’ @guildeducation.com                         â”‚        â”‚
â”‚  â”‚                                                              â”‚        â”‚
â”‚  â”‚  Retrieves from Databricks Secrets:                         â”‚        â”‚
â”‚  â”‚    GLEAN_GLOBAL_TOKEN (created by Glean Super Admin)        â”‚        â”‚
â”‚  â”‚                                                              â”‚        â”‚
â”‚  â”‚  Makes Glean API request with headers:                      â”‚        â”‚
â”‚  â”‚    Authorization: Bearer {GLEAN_GLOBAL_TOKEN}               â”‚        â”‚
â”‚  â”‚    X-Glean-ActAs: tony.kipkemboi@guildeducation.com         â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                          â”‚
â”‚  Step 5: Permission Enforcement                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Glean Enterprise Search:                                   â”‚        â”‚
â”‚  â”‚  âœ“ Validates X-Glean-ActAs header                           â”‚        â”‚
â”‚  â”‚  âœ“ Enforces user's actual permissions                        â”‚        â”‚
â”‚  â”‚  âœ“ Returns ONLY documents user can access                   â”‚        â”‚
â”‚  â”‚  âœ“ Logs action with actual user identity (audit trail)      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                          â”‚
â”‚  Security Properties:                                                   â”‚
â”‚  âœ… User identity verified by Databricks (cannot be spoofed)           â”‚
â”‚  âœ… Global token never exposed to browser                               â”‚
â”‚  âœ… User permissions enforced by Glean (not bypassable)                 â”‚
â”‚  âœ… Complete audit trail with actual user identity                      â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ğŸ¤– BACKEND AGENT ARCHITECTURE (MLflow ResponsesAgent)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATABRICKS MODEL SERVING ENDPOINT                                        â”‚
â”‚  Endpoint: databricks-eps-agent-dev (auto-scaling, scale-to-zero)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MLflow ResponsesAgent (/databricks/oai_reponses_agent/)        â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  Pattern: OpenAI-compatible agent with MLflow tracing            â”‚   â”‚
â”‚  â”‚  LLM: databricks-gpt-5-mini or Claude (Databricks-hosted)       â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  REQUEST HANDLER                                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  1. Receive messages + custom_inputs (user_email)        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  2. Load system prompt (claude_system_prompt.py)         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  3. Initialize tool registry (7 search tools)            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  4. Create agent loop                                     â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  AGENTIC REASONING LOOP                                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  User Query: "When is AdventHealth's renewal?"            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚       â”‚                                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚       â–¼                                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  LLM: ANALYZE                                    â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Parse query intent                            â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Identify account: "AdventHealth"              â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Goal: Find renewal date                       â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚       â”‚                                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚       â–¼                                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  LLM: PLAN TOOL CALLS                            â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Need: search_salesforce_opportunities         â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Query: "AdventHealth renewal"                 â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚       â”‚                                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚       â–¼                                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  EXECUTE TOOL                                    â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â†’ search_salesforce_opportunities               â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    (see Tool Execution section below)            â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚       â”‚                                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚       â–¼                                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  LLM: SYNTHESIZE RESPONSE                        â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Parse tool results                            â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Format with citations                         â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Add sentiment if needed                       â”‚     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚       â”‚                                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚       â–¼                                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Stream response to UI                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  Environment Variables (from Databricks Secrets):                â”‚   â”‚
â”‚  â”‚  - GLEAN_INSTANCE: guild-be.glean.com                           â”‚   â”‚
â”‚  â”‚  - GLEAN_GLOBAL_TOKEN: {secret}                                 â”‚   â”‚
â”‚  â”‚  - LLM_ENDPOINT: databricks-gpt-5-mini                          â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ Tool execution
                                   â–¼
```

---

## 4. ğŸ” TOOL ARCHITECTURE (7 Glean Search Tools)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SEARCH TOOL REGISTRY                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  All tools integrate with: Glean Enterprise Search API                   â”‚
â”‚  Endpoint: https://guild-be.glean.com/rest/api/v1/search                 â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. search_salesforce_opportunities                              â”‚   â”‚
â”‚  â”‚     Purpose: Renewals, contracts, deals                          â”‚   â”‚
â”‚  â”‚     Datasource: salescloud                                       â”‚   â”‚
â”‚  â”‚     Type Filter: opportunity                                     â”‚   â”‚
â”‚  â”‚     Example: "AdventHealth renewal", "Q4 deals"                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. search_salesforce_accounts                                   â”‚   â”‚
â”‚  â”‚     Purpose: Company info, account overview                      â”‚   â”‚
â”‚  â”‚     Datasource: salescloud                                       â”‚   â”‚
â”‚  â”‚     Type Filter: account                                         â”‚   â”‚
â”‚  â”‚     Example: "AdventHealth status", "account health"             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. search_salesforce_contacts                                   â”‚   â”‚
â”‚  â”‚     Purpose: Decision makers, stakeholders                       â”‚   â”‚
â”‚  â”‚     Datasource: salescloud                                       â”‚   â”‚
â”‚  â”‚     Type Filter: contact                                         â”‚   â”‚
â”‚  â”‚     Example: "AdventHealth decision makers"                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  4. search_metrics_and_dashboards                                â”‚   â”‚
â”‚  â”‚     Purpose: Funding caps, spend, dashboards                     â”‚   â”‚
â”‚  â”‚     Datasources: salescloud, looker                              â”‚   â”‚
â”‚  â”‚     Type Filter: dashboard, report                               â”‚   â”‚
â”‚  â”‚     Example: "AdventHealth funding", "Q3 spend"                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  5. search_strategy_docs                                         â”‚   â”‚
â”‚  â”‚     Purpose: QBRs, account plans, strategy                       â”‚   â”‚
â”‚  â”‚     Datasource: gdrive                                           â”‚   â”‚
â”‚  â”‚     Type Filter: document, presentation                          â”‚   â”‚
â”‚  â”‚     Example: "AdventHealth QBR", "2024 strategy"                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  6. search_communications                                        â”‚   â”‚
â”‚  â”‚     Purpose: Calls, sentiment, emails                            â”‚   â”‚
â”‚  â”‚     Datasources: gong, gmail, slack                              â”‚   â”‚
â”‚  â”‚     Example: "AdventHealth calls", "recent sentiment"            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  7. search_general_fallback                                      â”‚   â”‚
â”‚  â”‚     Purpose: All sources (requires user approval)                â”‚   â”‚
â”‚  â”‚     Datasources: ALL                                             â”‚   â”‚
â”‚  â”‚     Usage: Only when other tools don't match                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  Tool Execution Pattern:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  def search_salesforce_opportunities(query: str, user_email: str)â”‚    â”‚
â”‚  â”‚                                                                   â”‚    â”‚
â”‚  â”‚  1. Normalize user email (@guild.com â†’ @guildeducation.com)     â”‚    â”‚
â”‚  â”‚  2. Retrieve GLEAN_GLOBAL_TOKEN from secrets                    â”‚    â”‚
â”‚  â”‚  3. Build payload:                                               â”‚    â”‚
â”‚  â”‚     {                                                            â”‚    â”‚
â”‚  â”‚       "query": "AdventHealth renewal",                           â”‚    â”‚
â”‚  â”‚       "pageSize": 10,                                            â”‚    â”‚
â”‚  â”‚       "maxSnippetSize": 4000,                                    â”‚    â”‚
â”‚  â”‚       "requestOptions": {                                        â”‚    â”‚
â”‚  â”‚         "datasourcesFilter": ["salescloud"],                     â”‚    â”‚
â”‚  â”‚         "facetFilters": [                                        â”‚    â”‚
â”‚  â”‚           {"fieldName": "type",                                  â”‚    â”‚
â”‚  â”‚            "values": [{"value": "opportunity",                   â”‚    â”‚
â”‚  â”‚                        "relationType": "EQUALS"}]}               â”‚    â”‚
â”‚  â”‚         ],                                                        â”‚    â”‚
â”‚  â”‚         "returnLlmContentOverSnippets": true                     â”‚    â”‚
â”‚  â”‚       }                                                           â”‚    â”‚
â”‚  â”‚     }                                                             â”‚    â”‚
â”‚  â”‚  4. Make POST request with headers:                              â”‚    â”‚
â”‚  â”‚     Authorization: Bearer {GLEAN_GLOBAL_TOKEN}                   â”‚    â”‚
â”‚  â”‚     X-Glean-ActAs: tony.kipkemboi@guildeducation.com             â”‚    â”‚
â”‚  â”‚  5. Parse response (llmContent or snippets)                      â”‚    â”‚
â”‚  â”‚  6. Format results with title, URL, datasource, author, date    â”‚    â”‚
â”‚  â”‚  7. Return to LLM for synthesis                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                           â”‚
â”‚  HTTP Client: httpx (async-compatible, timeout: 30s)                     â”‚
â”‚  Error Handling: Exponential backoff with retries (backoff library)      â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ğŸ“Š DATA SOURCES (via Glean Enterprise Search)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INTEGRATED DATA SOURCES                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SALESFORCE (CRM)                                                 â”‚  â”‚
â”‚  â”‚  Datasource: salescloud                                           â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Opportunities (renewals, contracts, deal size, close date)  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Accounts (company info, ARR, health score, CSM)             â”‚  â”‚
â”‚  â”‚  â””â”€â”€ Contacts (decision makers, roles, contact info)             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  GOOGLE DRIVE (Strategy & Documents)                              â”‚  â”‚
â”‚  â”‚  Datasource: gdrive                                               â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ QBR Presentations                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Account Plans                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Strategy Documents                                           â”‚  â”‚
â”‚  â”‚  â””â”€â”€ Meeting Notes                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  GONG (Call Intelligence)                                         â”‚  â”‚
â”‚  â”‚  Datasource: gong                                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Call Recordings                                              â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Transcripts                                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Sentiment Analysis                                           â”‚  â”‚
â”‚  â”‚  â””â”€â”€ Talk Track Analytics                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  GMAIL + SLACK (Communications)                                   â”‚  â”‚
â”‚  â”‚  Datasources: gmail, slack                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Email Threads                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Slack Discussions                                            â”‚  â”‚
â”‚  â”‚  â””â”€â”€ Message History                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  LOOKER (Analytics & Dashboards)                                  â”‚  â”‚
â”‚  â”‚  Datasource: looker                                               â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Metrics Dashboards                                           â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Funding Caps                                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Spend Analysis                                               â”‚  â”‚
â”‚  â”‚  â””â”€â”€ Usage Reports                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  JIRA + CONFLUENCE (Operations)                                   â”‚  â”‚
â”‚  â”‚  Datasources: jira, confluence                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Tickets/Issues                                               â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Documentation                                                â”‚  â”‚
â”‚  â”‚  â””â”€â”€ Wikis                                                        â”‚  â”‚
â”‚  â”‚  Note: Via fallback tool only                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  Permissions: All searches respect user's actual permissions in each     â”‚
â”‚              source system (enforced by Glean)                           â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ğŸš€ DEPLOYMENT INFRASTRUCTURE (Databricks Asset Bundle)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATABRICKS DEPLOYMENT ARCHITECTURE                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  Configuration: databricks.yml                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  bundle:                                                        â”‚    â”‚
â”‚  â”‚    name: eps_account_agent                                      â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  targets:                                                        â”‚    â”‚
â”‚  â”‚    dev:                                                          â”‚    â”‚
â”‚  â”‚      catalog: eps_intelligence_dev                              â”‚    â”‚
â”‚  â”‚      schema: agents                                             â”‚    â”‚
â”‚  â”‚      model_name: eps_agent_dev                                  â”‚    â”‚
â”‚  â”‚      endpoint: databricks-eps-agent-dev                         â”‚    â”‚
â”‚  â”‚      root_path: /Workspace/Users/${user}/.bundle/.../dev        â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚    staging:                                                      â”‚    â”‚
â”‚  â”‚      catalog: eps_intelligence_staging                          â”‚    â”‚
â”‚  â”‚      schema: agents                                             â”‚    â”‚
â”‚  â”‚      model_name: eps_agent_staging                              â”‚    â”‚
â”‚  â”‚      endpoint: databricks-eps-agent-staging                     â”‚    â”‚
â”‚  â”‚      root_path: /Workspace/Shared/.bundle/.../staging           â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚    prod:                                                         â”‚    â”‚
â”‚  â”‚      catalog: eps_intelligence                                  â”‚    â”‚
â”‚  â”‚      schema: agents                                             â”‚    â”‚
â”‚  â”‚      model_name: eps_agent_prod                                 â”‚    â”‚
â”‚  â”‚      endpoint: databricks-eps-agent-prod                        â”‚    â”‚
â”‚  â”‚      root_path: /Workspace/Shared/.bundle/.../prod              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                           â”‚
â”‚  Deployment Flow:                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  LOCAL DEVELOPMENT                                              â”‚    â”‚
â”‚  â”‚  /Users/tonykipkemboi/Workspace/eps-chatbot/                    â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ databricks/oai_reponses_agent/                             â”‚    â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ eps_agent_dev.py        (Production agent)             â”‚    â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ eps_agent_cli.py        (Local testing)                â”‚    â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ prompts/                                               â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ requirements_dbx.txt                                   â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ client/                     (React UI)                     â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ server/                     (Backend proxy)                â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ databricks.yml              (Bundle config)                â”‚    â”‚
â”‚  â”‚  â””â”€â”€ deploy.sh                   (Deployment script)            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                    â”‚                                                      â”‚
â”‚                    â”‚ ./deploy.sh dev                                     â”‚
â”‚                    â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  DATABRICKS WORKSPACE                                           â”‚    â”‚
â”‚  â”‚  /Workspace/Users/tony.kipkemboi@guild.com/eps-chatbot-source/  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ client/dist/               (Built React assets)            â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ server/dist/               (Built server code)             â”‚    â”‚
â”‚  â”‚  â””â”€â”€ databricks/                (Python agent code)             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                    â”‚                                                      â”‚
â”‚                    â”‚ databricks bundle deploy --target dev               â”‚
â”‚                    â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  UNITY CATALOG                                                  â”‚    â”‚
â”‚  â”‚  eps_intelligence_dev.agents.eps_agent_dev                      â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ MLflow Model Registration                                  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Version: 1, 2, 3...                                        â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Dependencies: requirements_dbx.txt                         â”‚    â”‚
â”‚  â”‚  â””â”€â”€ Tracing: Enabled                                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                    â”‚                                                      â”‚
â”‚                    â”‚ Deploy to Model Serving                             â”‚
â”‚                    â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  MODEL SERVING ENDPOINT                                         â”‚    â”‚
â”‚  â”‚  databricks-eps-agent-dev                                       â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Compute: Serverless (auto-scaling, scale-to-zero)         â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Served Model: eps_agent_dev (latest version)              â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Environment Variables:                                     â”‚    â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ GLEAN_INSTANCE=guild-be.glean.com                     â”‚    â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ GLEAN_GLOBAL_TOKEN={{secrets/eps_agent_scope/...}}    â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ LLM_ENDPOINT=databricks-gpt-5-mini                    â”‚    â”‚
â”‚  â”‚  â””â”€â”€ Endpoint URL: /serving-endpoints/responses                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                    â”‚                                                      â”‚
â”‚                    â”‚ databricks bundle run databricks_chatbot            â”‚
â”‚                    â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  DATABRICKS APP (SERVICE PRINCIPAL)                             â”‚    â”‚
â”‚  â”‚  /Workspace/Users/881f3cd3-1bdb-40d3-86b3-f270e95d420f/         â”‚    â”‚
â”‚  â”‚  â””â”€â”€ src/{deployment_id}/       (Snapshot copy)                 â”‚    â”‚
â”‚  â”‚      â”œâ”€â”€ client/dist/                                           â”‚    â”‚
â”‚  â”‚      â””â”€â”€ server/dist/                                           â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  Public URL:                                                    â”‚    â”‚
â”‚  â”‚  https://eps-agent-dev-tony-kipkemboi-7711090402957940...       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                           â”‚
â”‚  Deployment Commands:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  cd /Users/tonykipkemboi/Workspace/eps-chatbot                  â”‚    â”‚
â”‚  â”‚  ./deploy.sh dev        # Deploy to dev                         â”‚    â”‚
â”‚  â”‚  ./deploy.sh staging    # Deploy to staging                     â”‚    â”‚
â”‚  â”‚  ./deploy.sh prod       # Deploy to production                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                           â”‚
â”‚  deploy.sh Script Steps:                                                 â”‚
â”‚  1. Build UI (npm run build)                                             â”‚
â”‚  2. Clean workspace (.databricks, .git folders)                          â”‚
â”‚  3. Sync critical source files (message.tsx, chain-of-thought.tsx, etc.) â”‚
â”‚  4. Sync built artifacts (client/dist, server/dist)                      â”‚
â”‚  5. Deploy bundle (databricks bundle deploy)                             â”‚
â”‚  6. Start app (databricks bundle run)                                    â”‚
â”‚  7. Wait 3-5 minutes for deployment                                      â”‚
â”‚  8. Hard refresh browser to see changes                                  â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ğŸ”„ END-TO-END DATA FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COMPLETE REQUEST-RESPONSE CYCLE                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Step 1: USER QUERY                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  User types in chat: "When is AdventHealth's renewal?"          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                     â”‚
â”‚                    â–¼                                                     â”‚
â”‚  Step 2: UI PROCESSING                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. Extract JWT from x-forwarded-access-token header            â”‚   â”‚
â”‚  â”‚  2. Validate JWT signature (RS256 with Databricks public key)   â”‚   â”‚
â”‚  â”‚  3. Check expiration & issuer                                    â”‚   â”‚
â”‚  â”‚  4. Extract user_email from JWT.sub                              â”‚   â”‚
â”‚  â”‚  5. Build request payload:                                       â”‚   â”‚
â”‚  â”‚     POST /serving-endpoints/responses                            â”‚   â”‚
â”‚  â”‚     {                                                             â”‚   â”‚
â”‚  â”‚       "messages": [                                               â”‚   â”‚
â”‚  â”‚         {"role": "user", "content": "When is AdventHealth..."}   â”‚   â”‚
â”‚  â”‚       ],                                                          â”‚   â”‚
â”‚  â”‚       "custom_inputs": {                                          â”‚   â”‚
â”‚  â”‚         "user_email": "tony.kipkemboi@guild.com",                â”‚   â”‚
â”‚  â”‚         "conversation_id": "abc123"                               â”‚   â”‚
â”‚  â”‚       }                                                            â”‚   â”‚
â”‚  â”‚     }                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                     â”‚
â”‚                    â–¼                                                     â”‚
â”‚  Step 3: BACKEND AGENT RECEIVES REQUEST                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. Load system prompt (claude_system_prompt.py)                â”‚   â”‚
â”‚  â”‚  2. Initialize tool registry (7 search tools)                   â”‚   â”‚
â”‚  â”‚  3. Create agent loop with user message                         â”‚   â”‚
â”‚  â”‚  4. Store user_email in context for tool calls                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                     â”‚
â”‚                    â–¼                                                     â”‚
â”‚  Step 4: LLM REASONING (ANALYZE)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  LLM analyzes query:                                            â”‚   â”‚
â”‚  â”‚  - Account: "AdventHealth"                                      â”‚   â”‚
â”‚  â”‚  - Intent: Find renewal date                                    â”‚   â”‚
â”‚  â”‚  - Category: Opportunity/Contract                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                     â”‚
â”‚                    â–¼                                                     â”‚
â”‚  Step 5: LLM REASONING (PLAN)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  LLM decides to call:                                           â”‚   â”‚
â”‚  â”‚  Tool: search_salesforce_opportunities                          â”‚   â”‚
â”‚  â”‚  Query: "AdventHealth renewal"                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                     â”‚
â”‚                    â–¼                                                     â”‚
â”‚  Step 6: TOOL EXECUTION                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  search_salesforce_opportunities(                               â”‚   â”‚
â”‚  â”‚    query="AdventHealth renewal",                                â”‚   â”‚
â”‚  â”‚    user_email="tony.kipkemboi@guild.com"                        â”‚   â”‚
â”‚  â”‚  )                                                               â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  1. Normalize email: @guild.com â†’ @guildeducation.com           â”‚   â”‚
â”‚  â”‚  2. Retrieve GLEAN_GLOBAL_TOKEN from Databricks Secrets         â”‚   â”‚
â”‚  â”‚  3. Build Glean API request:                                    â”‚   â”‚
â”‚  â”‚     POST https://guild-be.glean.com/rest/api/v1/search          â”‚   â”‚
â”‚  â”‚     Headers:                                                     â”‚   â”‚
â”‚  â”‚       Authorization: Bearer {GLEAN_GLOBAL_TOKEN}                â”‚   â”‚
â”‚  â”‚       X-Glean-ActAs: tony.kipkemboi@guildeducation.com          â”‚   â”‚
â”‚  â”‚     Body:                                                        â”‚   â”‚
â”‚  â”‚       {                                                          â”‚   â”‚
â”‚  â”‚         "query": "AdventHealth renewal",                         â”‚   â”‚
â”‚  â”‚         "pageSize": 10,                                          â”‚   â”‚
â”‚  â”‚         "requestOptions": {                                      â”‚   â”‚
â”‚  â”‚           "datasourcesFilter": ["salescloud"],                   â”‚   â”‚
â”‚  â”‚           "facetFilters": [                                      â”‚   â”‚
â”‚  â”‚             {"fieldName": "type", "values": [                    â”‚   â”‚
â”‚  â”‚               {"value": "opportunity", "relationType": "EQUALS"} â”‚   â”‚
â”‚  â”‚             ]}                                                    â”‚   â”‚
â”‚  â”‚           ]                                                       â”‚   â”‚
â”‚  â”‚         }                                                         â”‚   â”‚
â”‚  â”‚       }                                                           â”‚   â”‚
â”‚  â”‚  4. Glean enforces user permissions                             â”‚   â”‚
â”‚  â”‚  5. Returns 5 Salesforce opportunities user can access          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                     â”‚
â”‚                    â–¼                                                     â”‚
â”‚  Step 7: TOOL RESULT FORMATTING                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Format results for LLM:                                        â”‚   â”‚
â”‚  â”‚  [                                                               â”‚   â”‚
â”‚  â”‚    {                                                             â”‚   â”‚
â”‚  â”‚      "title": "AdventHealth - 2026 Renewal",                    â”‚   â”‚
â”‚  â”‚      "url": "https://guild.lightning.force.com/...",            â”‚   â”‚
â”‚  â”‚      "datasource": "Salesforce",                                â”‚   â”‚
â”‚  â”‚      "author": "John Smith",                                    â”‚   â”‚
â”‚  â”‚      "createTime": "2025-12-15",                                â”‚   â”‚
â”‚  â”‚      "snippet": "Renewal date: August 2026, $2.4M..."           â”‚   â”‚
â”‚  â”‚    },                                                            â”‚   â”‚
â”‚  â”‚    ...                                                           â”‚   â”‚
â”‚  â”‚  ]                                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                     â”‚
â”‚                    â–¼                                                     â”‚
â”‚  Step 8: LLM SYNTHESIS                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  LLM processes tool results and generates response:             â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  "**AdventHealth's renewal is August 2026** ($2.4M).            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Key details:                                                    â”‚   â”‚
â”‚  â”‚  - **Renewal Date**: August 2026                                â”‚   â”‚
â”‚  â”‚  - **Contract Value**: $2.4M                                    â”‚   â”‚
â”‚  â”‚  - **Status**: ğŸŸ¢ In Progress                                   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Focus areas for H2:                                            â”‚   â”‚
â”‚  â”‚  - In-Person EBR demonstration (strategic value)                â”‚   â”‚
â”‚  â”‚  - SSO implementation for leader approvals                      â”‚   â”‚
â”‚  â”‚  - HRIS coordination                                            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  [AdventHealth Renewal](https://guild.lightning.force.com/...)  â”‚   â”‚
â”‚  â”‚  "                                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                     â”‚
â”‚                    â–¼                                                     â”‚
â”‚  Step 9: STREAM TO UI                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Response streams to frontend in chunks                         â”‚   â”‚
â”‚  â”‚  UI renders markdown with hyperlinked sources                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                     â”‚
â”‚                    â–¼                                                     â”‚
â”‚  Step 10: UI DISPLAY                                                    â”‚
â”‚  â”Œâ”€â”€â”€ï¿½ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  User sees:                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ” Show work â€¢ 1 source                                  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ [Collapsed] search_salesforce_opportunities          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Sources Found:                                           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  [AdventHealth Renewal] [Related Opp] ...                â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  **AdventHealth's renewal is August 2026** ($2.4M).      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  [Rest of formatted response...]                          â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  Total Time: ~3-5 seconds                                               â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ğŸ—ï¸ SYSTEM ARCHITECTURE SUMMARY

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ARCHITECTURE LAYERS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Layer 1: PRESENTATION                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  React UI + TypeScript                                          â”‚   â”‚
â”‚  â”‚  - Databricks Apps (Public URL)                                 â”‚   â”‚
â”‚  â”‚  - Message components with Chain of Thought display             â”‚   â”‚
â”‚  â”‚  - Source carousel for document links                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  Layer 2: AUTHENTICATION                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  OAuth 2.0 + JWT + ActAs Pattern                                â”‚   â”‚
â”‚  â”‚  - Okta SSO â†’ Databricks OIDC                                   â”‚   â”‚
â”‚  â”‚  - JWT validation (RS256 signature)                             â”‚   â”‚
â”‚  â”‚  - ActAs header for permission enforcement                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  Layer 3: AGENT ORCHESTRATION                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MLflow ResponsesAgent                                          â”‚   â”‚
â”‚  â”‚  - LLM reasoning loop (Analyze â†’ Plan â†’ Execute â†’ Synthesize)  â”‚   â”‚
â”‚  â”‚  - Tool registry (7 search tools)                               â”‚   â”‚
â”‚  â”‚  - Streaming responses                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  Layer 4: TOOL EXECUTION                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Glean Enterprise Search Integration                            â”‚   â”‚
â”‚  â”‚  - 7 specialized search tools                                   â”‚   â”‚
â”‚  â”‚  - Datasource filtering (Salesforce, Drive, Gong, etc.)        â”‚   â”‚
â”‚  â”‚  - User-scoped permissions                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  Layer 5: DATA SOURCES                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Enterprise Systems                                             â”‚   â”‚
â”‚  â”‚  - Salesforce (CRM)                                             â”‚   â”‚
â”‚  â”‚  - Google Drive (Documents)                                     â”‚   â”‚
â”‚  â”‚  - Gong (Call Intelligence)                                     â”‚   â”‚
â”‚  â”‚  - Gmail/Slack (Communications)                                 â”‚   â”‚
â”‚  â”‚  - Looker (Analytics)                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  Layer 6: INFRASTRUCTURE                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Databricks Platform                                            â”‚   â”‚
â”‚  â”‚  - Model Serving (auto-scaling, serverless)                     â”‚   â”‚
â”‚  â”‚  - Unity Catalog (model registry)                               â”‚   â”‚
â”‚  â”‚  - Databricks Apps (UI hosting)                                 â”‚   â”‚
â”‚  â”‚  - Secrets management                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. ğŸ”‘ KEY ARCHITECTURAL DECISIONS

| Decision | Rationale | Trade-offs |
|----------|-----------|------------|
| **ActAs Pattern** | Standard OAuth for impersonation; Glean doesn't recognize Databricks as OAuth provider | Requires global token, but more secure than user tokens |
| **MLflow ResponsesAgent** | Native Databricks integration; OpenAI API compatibility; Built-in tracing | Locked into MLflow ecosystem |
| **One Tool at a Time** | Ensures proper error handling; Matches LLM reasoning loop; Clearer tracing | Multiple searches take longer |
| **Glean Datasource Filtering** | Semantic ranking can be noisy; Need precise source routing | Separate tools for each datasource |
| **Email Normalization** | Glean only recognizes @guildeducation.com (not @guild.com) | Manual domain mapping required |
| **Three Deployment Targets** | Clear separation: dev/staging/prod catalogs | More configuration to maintain |
| **Dual-prompt Strategy** | Different LLMs have different instruction preferences | Must maintain two prompt versions |
| **UI Deployment Script** | Recurring deployment issues needed automation | Manual sync required before bundle deploy |

---

## 10. ğŸ“ˆ SYSTEM METRICS & SCALE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PERFORMANCE CHARACTERISTICS                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  Response Time:                                                      â”‚
â”‚  - Simple query (1 tool call): 3-5 seconds                           â”‚
â”‚  - Complex query (multiple tools): 8-12 seconds                      â”‚
â”‚  - Streaming enabled: First token <1 second                          â”‚
â”‚                                                                       â”‚
â”‚  Concurrency:                                                        â”‚
â”‚  - Model Serving: Auto-scaling (scale-to-zero enabled)              â”‚
â”‚  - Max concurrent requests: Serverless (elastic)                     â”‚
â”‚                                                                       â”‚
â”‚  Data Volume:                                                        â”‚
â”‚  - Glean index: All connected enterprise systems                     â”‚
â”‚  - Search results: Max 10 documents per tool call                    â”‚
â”‚  - Snippet size: Up to 4000 characters per document                  â”‚
â”‚                                                                       â”‚
â”‚  Costs:                                                              â”‚
â”‚  - LLM: Pay per token (Databricks-hosted model)                     â”‚
â”‚  - Compute: Serverless (pay for actual usage)                        â”‚
â”‚  - Storage: Unity Catalog (model versions)                           â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. ğŸ›¡ï¸ SECURITY ARCHITECTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SECURITY CONTROLS                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  Identity & Access:                                                  â”‚
â”‚  âœ… Okta SSO (MFA enabled)                                           â”‚
â”‚  âœ… Databricks OIDC (RS256 JWT)                                      â”‚
â”‚  âœ… JWT signature verification in UI                                 â”‚
â”‚  âœ… ActAs header for user impersonation                              â”‚
â”‚                                                                       â”‚
â”‚  Permission Enforcement:                                             â”‚
â”‚  âœ… User-level permissions (enforced by Glean)                       â”‚
â”‚  âœ… No permission escalation possible                                â”‚
â”‚  âœ… Cannot access documents user doesn't own                         â”‚
â”‚                                                                       â”‚
â”‚  Secrets Management:                                                 â”‚
â”‚  âœ… Databricks Secret Scope (encrypted at rest)                      â”‚
â”‚  âœ… Global token never exposed to browser                            â”‚
â”‚  âœ… Personal tokens only for local dev (never production)            â”‚
â”‚                                                                       â”‚
â”‚  Audit Trail:                                                        â”‚
â”‚  âœ… All searches logged with actual user identity                    â”‚
â”‚  âœ… MLflow tracing for all agent interactions                        â”‚
â”‚  âœ… Glean logs every API call                                        â”‚
â”‚                                                                       â”‚
â”‚  Data Protection:                                                    â”‚
â”‚  âœ… TLS 1.2+ for all communications                                  â”‚
â”‚  âœ… No PII stored in agent code                                      â”‚
â”‚  âœ… Results scoped to user's permissions                             â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 12. ğŸ“š DOCUMENTATION REFERENCE

- **ActAs_Authentication_Flow.md** - Security flow with sequence diagrams
- **Authentication_Flow_UI_to_Agent.md** - JWT validation at each layer
- **IT_Security_Review_ActAs_Implementation.md** - Security analysis for IT
- **Databricks_Native_Deployment_Guide.md** - Step-by-step deployment
- **UI_Integration_Analysis.md** - Frontend/backend contract
- **User_Error_Messages.md** - Error handling and user feedback
- **OAuth_Migration_Summary.md** - History of auth pattern evolution
- **IT_Walkthrough_Script.md** - Demo script for IT review

---

## 13. ğŸš€ DEPLOYMENT QUICK REFERENCE

```bash
# Local Development
cd /Users/tonykipkemboi/Workspace/eps-chatbot

# Deploy to environments
./deploy.sh dev         # Deploy to development
./deploy.sh staging     # Deploy to staging
./deploy.sh prod        # Deploy to production

# Verify deployment
# 1. Wait 3-5 minutes
# 2. Open app URL
# 3. Hard refresh browser (Cmd+Shift+R)
# 4. Test query: "What's the renewal date for AdventHealth?"
```

**What deploy.sh does:**
1. Builds UI (`npm run build`)
2. Cleans workspace (removes `.databricks`, `.git`)
3. Syncs critical source files
4. Syncs built artifacts (`client/dist`, `server/dist`)
5. Deploys bundle (`databricks bundle deploy`)
6. Starts app (`databricks bundle run`)

---

**Architecture Design:** Production-grade agentic system with enterprise security controls, user-scoped permissions, complete audit trails, and multi-environment deployment capabilities.
